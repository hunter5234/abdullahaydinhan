<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kelime Oyunu</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            touch-action: manipulation;
            transition: background-color 0.3s, color 0.3s;
        }
        .light { background-color: #f0f0f0; color: #333; }
        .dark { background-color: #333; color: #fff; }
        .dark #game-container, .dark #settings-container, .dark #how-to-play-container { background-color: #444; }
        .colorful { background: linear-gradient(135deg, #ffecd2, #fcb69f); color: #333; }
        #settings-container, #game-container, #how-to-play-container {
            text-align: center;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            width: 300px;
        }
        #how-to-play-container {
            display: none;
            width: 90%;
            max-width: 600px;
        }
        #game-container {
            position: relative;
            display: none;
            width: 90%;
            max-width: 800px;
        }
        #word {
            font-size: 3em;
            margin: 20px 0;
            transition: color 0.3s ease;
            word-break: break-word;
            animation: slideIn 0.3s ease-in-out;
        }
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .correct { color: green !important; animation: shake 0.2s; }
        .incorrect { color: red !important; animation: shake 0.2s; }
        .pass { color: blue !important; animation: shake 0.2s; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(5px); }
        }
        #correct-score {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 1.2em;
            color: green;
        }
        #incorrect-score {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.2em;
            color: red;
        }
        #pass-count {
            position: absolute;
            bottom: 10px;
            right: 10px;
            font-size: 1.2em;
            color: blue;
        }
        #timer {
            font-size: 2.5em;
            color: #333;
            margin-bottom: 10px;
        }
        #timer.low {
            color: red;
            animation: blink 1s infinite;
        }
        @keyframes blink {
            50% { opacity: 0.5; }
        }
        #progress-bar {
            width: 100%;
            height: 10px;
            background: #ddd;
            margin-bottom: 20px;
        }
        #progress {
            width: 100%;
            height: 100%;
            background: #4CAF50;
            transition: width 0.3s;
        }
        #game-over {
            font-size: 1.5em;
            display: none;
            margin-top: 20px;
        }
        #replay-button, #clear-history-button, #how-to-play-button, #back-to-settings-button, #pause-button, #quick-start-button, #export-button {
            margin-top: 10px;
            padding: 12px 24px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2em;
        }
        #replay-button:hover, #clear-history-button:hover, #how-to-play-button:hover, #back-to-settings-button:hover, #pause-button:hover, #quick-start-button:hover, #export-button:hover {
            background-color: #45a049;
        }
        #fullscreen-button {
            position: absolute;
            bottom: 10px;
            left: 10px;
            padding: 5px 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #fullscreen-button:hover {
            background-color: #45a049;
        }
        #file-input, #duration-select, #word-count-select, #pass-count-select, #sound-toggle, #difficulty-select, #sound-set-select, #theme-select {
            margin: 10px 0;
        }
        #start-button {
            margin-top: 10px;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #start-button:hover {
            background-color: #45a049;
        }
        #history-table {
            margin-top: 20px;
            width: 100%;
            border-collapse: collapse;
        }
        #history-table th, #history-table td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        #history-table th {
            background-color: #4CAF50;
            color: white;
        }
        .correct { color: green !important; font-weight: bold; }
        .incorrect, .pass { color: red !important; font-weight: bold; }
        #touch-controls {
            position: absolute;
            bottom: 50px;
            left: 0;
            right: 0;
            height: 100px;
            display: none;
        }
        #touch-left, #touch-right, #touch-middle {
            position: absolute;
            height: 100%;
            top: 0;
            transition: background 0.3s;
        }
        #touch-left { left: 0; width: 33%; background: green; opacity: 0.2; }
        #touch-right { right: 0; width: 33%; background: red; opacity: 0.2; }
        #touch-middle { left: 33%; width: 34%; background: blue; opacity: 0.2; }
        #loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            display: none;
        }
        #footer {
            position: fixed;
            bottom: 10px;
            text-align: center;
            width: 100%;
            font-size: 0.9em;
            color: #555;
        }
        @media (max-width: 600px) {
            #touch-controls { display: block; }
            #game-container { width: 100%; }
            #word { font-size: 2.5em; }
        }
    </style>
</head>
<body class="light">
    <div id="settings-container">
        <h2>Ayarlar</h2>
        <div>
            <label for="file-input">Excel Dosyası Yükle:</label><br>
            <input type="file" id="file-input" accept=".xlsx, .xls">
        </div>
        <div>
            <label for="duration-select">Toplam Süre (saniye):</label><br>
            <select id="duration-select"></select>
        </div>
        <div>
            <label for="word-count-select">Kelime Sayısı:</label><br>
            <select id="word-count-select"></select>
        </div>
        <div>
            <label for="pass-count-select">Pas Sayısı:</label><br>
            <select id="pass-count-select"></select>
        </div>
        <div>
            <label for="difficulty-select">Zorluk Seviyesi:</label><br>
            <select id="difficulty-select">
                <option value="simple">Basit</option>
                <option value="medium">Orta</option>
                <option value="hard">Zor</option>
                <option value="random" selected>Rastgele</option>
            </select>
        </div>
        <div>
            <label for="correct-key">Doğru Tuşu:</label><br>
            <input type="text" id="correct-key" maxlength="1" placeholder="A" value="A">
        </div>
        <div>
            <label for="incorrect-key">Yanlış Tuşu:</label><br>
            <input type="text" id="incorrect-key" maxlength="1" placeholder="L" value="L">
        </div>
        <div>
            <label for="pass-key">Pas Tuşu:</label><br>
            <input type="text" id="pass-key" maxlength="1" placeholder="Boşluk" value=" ">
        </div>
        <div>
            <label for="sound-toggle">Ses:</label><br>
            <input type="checkbox" id="sound-toggle" checked>
        </div>
        <div>
            <label for="sound-set-select">Ses Seti:</label><br>
            <select id="sound-set-select">
                <option value="classic">Klasik</option>
                <option value="fun">Eğlenceli</option>
                <option value="minimal">Minimal</option>
            </select>
        </div>
        <div>
            <label for="theme-select">Tema:</label><br>
            <select id="theme-select">
                <option value="light">Açık</option>
                <option value="dark">Koyu</option>
                <option value="colorful">Renkli</option>
            </select>
        </div>
        <button id="quick-start-button">Hızlı Başlat</button>
        <button id="clear-history-button">Geçmişi Sil</button>
        <button id="export-button">Sonuçları Dışa Aktar</button>
        <button id="how-to-play-button">Nasıl Oynanır?</button>
        <button id="start-button">Oyunu Başlat</button>
    </div>
    <div id="how-to-play-container">
        <h2>Nasıl Oynanır?</h2>
        <p>
            Bu oyun, Excel dosyasından rastgele seçilen kelimelerle oynanan bir bilgi yarışmasıdır. Aşağıda oyunun oynanışı, puanlama sistemi ve kontroller açıklanmıştır:
        </p>
        <h3>Oynanış</h3>
        <ul>
            <li>Ayarlar sayfasında bir Excel dosyası yükleyin (kelimeler A, kategoriler B, tanımlar C sütununda).</li>
            <li>Toplam süreyi (10-300 saniye), kelime sayısını (10-500), pas hakkını (1-50) ve zorluk seviyesini seçin.</li>
            <li>Doğru, yanlış ve pas için tuşları özelleştirin (varsayılan: A, L, Boşluk).</li>
            <li>Oyun başladığında kelimeler sırayla gösterilir. Süre bitene veya kelimeler tükenene kadar oynayın.</li>
            <li>Tam ekran modunu veya duraklatma özelliğini kullanabilirsiniz.</li>
        </ul>
        <h3>Puanlama</h3>
        <ul>
            <li><span style="color: green;">Doğru cevap</span>: Basit (+1), Orta (+2), Zor (+3).</li>
            <li><span style="color: green;">Hızlı cevap</span> (2 saniye içinde): +0.5 puan.</li>
            <li><span style="color: green;">5 doğru streak</span>: +5 puan.</li>
            <li><span style="color: red;">Yanlış cevap</span>: -1 puan.</li>
            <li><span style="color: red;">Pas</span>: -0.5 puan.</li>
        </ul>
        <h3>Kontroller</h3>
        <ul>
            <li><b>Doğru</b>: Varsayılan A tuşu. Kelime yeşile döner.</li>
            <li><b>Yanlış</b>: Varsayılan L tuşu. Kelime kırmızıya döner.</li>
            <li><b>Pas</b>: Varsayılan Boşluk tuşu. Kelime maviye döner.</li>
            <li><b>Mobil</b>: Ekranın solu (doğru), sağı (yanlış), ortası (pas).</li>
        </ul>
        <button id="back-to-settings-button">Ayarlar’a Dön</button>
    </div>
    <div id="game-container">
        <div id="timer">Süre: 100</div>
        <div id="progress-bar"><div id="progress"></div></div>
        <div id="correct-score">Doğru: 0</div>
        <div id="incorrect-score">Yanlış: 0</div>
        <div id="pass-count">Pas: 10</div>
        <div id="word"></div>
        <button id="pause-button">Duraklat</button>
        <button id="fullscreen-button">Tam Ekran</button>
        <div id="touch-controls">
            <div id="touch-left"></div>
            <div id="touch-middle"></div>
            <div id="touch-right"></div>
        </div>
        <div id="game-over"></div>
    </div>
    <div id="loading">Yükleniyor...</div>
    <div id="footer">Bu Oyun İngilizce Öğretmeni Abdullah AYDINHAN tarafından hazırlanmıştır.</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        let words = { simple: [], medium: [], hard: [] };
        let definitions = { simple: {}, medium: {}, hard: {} };
        let gameWords = [];
        let usedWords = { simple: new Set(), medium: new Set(), hard: new Set() };
        let gameHistory = JSON.parse(localStorage.getItem("gameHistory")) || [];
        let currentWordIndex = 0;
        let correctCount = { simple: 0, medium: 0, hard: 0 };
        let incorrectCount = { simple: 0, medium: 0, hard: 0 };
        let passCount = 10;
        let initialPassCount = 10;
        let timeLeft = 100;
        let timerInterval = null;
        let soundEnabled = true;
        let isPaused = false;
        let streak = 0;
        let wordStartTime = 0;
        let fastestResponse = Infinity;
        let missedWords = [];
        let currentPlayer = 1;
        let playerScores = { 1: { correct: { simple: 0, medium: 0, hard: 0 }, incorrect: { simple: 0, medium: 0, hard: 0 }, pass: 0, total: 0 } };
        const settingsContainer = document.getElementById("settings-container");
        const gameContainer = document.getElementById("game-container");
        const howToPlayContainer = document.getElementById("how-to-play-container");
        const wordElement = document.getElementById("word");
        const correctScoreElement = document.getElementById("correct-score");
        const incorrectScoreElement = document.getElementById("incorrect-score");
        const passCountElement = document.getElementById("pass-count");
        const timerElement = document.getElementById("timer");
        const gameOverElement = document.getElementById("game-over");
        const fileInput = document.getElementById("file-input");
        const durationSelect = document.getElementById("duration-select");
        const wordCountSelect = document.getElementById("word-count-select");
        const passCountSelect = document.getElementById("pass-count-select");
        const difficultySelect = document.getElementById("difficulty-select");
        const correctKeyInput = document.getElementById("correct-key");
        const incorrectKeyInput = document.getElementById("incorrect-key");
        const passKeyInput = document.getElementById("pass-key");
        const soundToggle = document.getElementById("sound-toggle");
        const soundSetSelect = document.getElementById("sound-set-select");
        const themeSelect = document.getElementById("theme-select");
        const startButton = document.getElementById("start-button");
        const quickStartButton = document.getElementById("quick-start-button");
        const clearHistoryButton = document.getElementById("clear-history-button");
        const exportButton = document.getElementById("export-button");
        const howToPlayButton = document.getElementById("how-to-play-button");
        const backToSettingsButton = document.getElementById("back-to-settings-button");
        const pauseButton = document.getElementById("pause-button");
        const fullscreenButton = document.getElementById("fullscreen-button");
        const touchLeft = document.getElementById("touch-left");
        const touchRight = document.getElementById("touch-right");
        const touchMiddle = document.getElementById("touch-middle");
        const touchControls = document.getElementById("touch-controls");
        const progressBar = document.getElementById("progress");
        const loadingIndicator = document.getElementById("loading");

        // Ses efektleri
        const soundSets = {
            classic: {
                correct: "https://www.soundjay.com/buttons/beep-01a.mp3",
                incorrect: "https://www.soundjay.com/buttons/beep-02.mp3",
                pass: "https://www.soundjay.com/buttons/beep-03.mp3",
                start: "https://www.soundjay.com/misc/sounds/transition-swoosh-02.mp3",
                end: "https://www.soundjay.com/misc/sounds/game-over-02.mp3"
            },
            fun: {
                correct: "https://www.soundjay.com/misc/sounds/positive-beep-01.mp3",
                incorrect: "https://www.soundjay.com/misc/sounds/negative-beep-01.mp3",
                pass: "https://www.soundjay.com/misc/sounds/click-01.mp3",
                start: "https://www.soundjay.com/misc/sounds/magic-wand-01.mp3",
                end: "https://www.soundjay.com/misc/sounds/sad-trombone-01.mp3"
            },
            minimal: {
                correct: "https://www.soundjay.com/buttons/sounds/button-09.mp3",
                incorrect: "https://www.soundjay.com/buttons/sounds/button-10.mp3",
                pass: "https://www.soundjay.com/buttons/sounds/button-11.mp3",
                start: "https://www.soundjay.com/buttons/sounds/button-12.mp3",
                end: "https://www.soundjay.com/buttons/sounds/button-13.mp3"
            }
        };
        let currentSoundSet = soundSets.classic;
        let correctSound = new Audio(currentSoundSet.correct);
        let incorrectSound = new Audio(currentSoundSet.incorrect);
        let passSound = new Audio(currentSoundSet.pass);
        let gameStartSound = new Audio(currentSoundSet.start);
        let gameEndSound = new Audio(currentSoundSet.end);

        // Süre seçenekleri
        for (let i = 10; i <= 300; i++) {
            const option = document.createElement("option");
            option.value = i;
            option.textContent = i;
            if (i === 100) option.selected = true;
            durationSelect.appendChild(option);
        }

        // Kelime sayısı seçenekleri
        for (let i = 10; i <= 500; i += 10) {
            const option = document.createElement("option");
            option.value = i;
            option.textContent = i;
            if (i === 100) option.selected = true;
            wordCountSelect.appendChild(option);
        }

        // Pas sayısı seçenekleri
        for (let i = 1; i <= 50; i++) {
            const option = document.createElement("option");
            option.value = i;
            option.textContent = i;
            if (i === 10) option.selected = true;
            passCountSelect.appendChild(option);
        }

        // Tema değiştirme
        themeSelect.addEventListener("change", () => {
            document.body.className = themeSelect.value;
        });

        // Ses seti değiştirme
        soundSetSelect.addEventListener("change", () => {
            currentSoundSet = soundSets[soundSetSelect.value];
            correctSound = new Audio(currentSoundSet.correct);
            incorrectSound = new Audio(currentSoundSet.incorrect);
            passSound = new Audio(currentSoundSet.pass);
            gameStartSound = new Audio(currentSoundSet.start);
            gameEndSound = new Audio(currentSoundSet.end);
        });

        // Excel dosyasını oku
        fileInput.addEventListener("change", async (event) => {
            const file = event.target.files[0];
            if (!file) return;

            loadingIndicator.style.display = "block";
            fileInput.disabled = true;
            await new Promise(resolve => setTimeout(resolve, 0));

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: "array" });
                    const sheetName = workbook.SheetNames[0];
                    const sheet = workbook.Sheets[sheetName];
                    const json = XLSX.utils.sheet_to_json(sheet, { header: 1 });

                    words = { simple: [], medium: [], hard: [] };
                    definitions = { simple: {}, medium: {}, hard: {} };
                    usedWords = { simple: new Set(), medium: new Set(), hard: new Set() };
                    json.forEach(row => {
                        if (row[0] && typeof row[0] === "string" && row[1]) {
                            const category = row[1].toLowerCase();
                            if (["simple", "medium", "hard"].includes(category)) {
                                words[category].push(row[0]);
                                definitions[category][row[0]] = row[2] || "Tanım belirtilmemiş";
                            }
                        }
                    });

                    if (Object.values(words).every(arr => arr.length === 0)) {
                        alert("Excel dosyasında geçerli kelime veya kategori bulunamadı!");
                    }
                } catch (error) {
                    alert("Excel dosyası okunamadı: " + error.message);
                } finally {
                    loadingIndicator.style.display = "none";
                    fileInput.disabled = false;
                }
            };
            reader.readAsArrayBuffer(file);
        });

        // Geçmişi sil
        clearHistoryButton.addEventListener("click", () => {
            if (confirm("Geçmiş sonuçları silmek istediğinize emin misiniz?")) {
                gameHistory = [];
                localStorage.setItem("gameHistory", JSON.stringify(gameHistory));
                alert("Geçmiş silindi!");
            }
        });

        // Sonuçları dışa aktar
        exportButton.addEventListener("click", () => {
            const data = JSON.stringify(gameHistory);
            const blob = new Blob([data], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "oyun_gecmisi.json";
            a.click();
            URL.revokeObjectURL(url);
        });

        // Nasıl Oynanır sayfasına geçiş
        howToPlayButton.addEventListener("click", () => {
            settingsContainer.style.display = "none";
            howToPlayContainer.style.display = "block";
        });

        // Ayarlar’a dönüş
        backToSettingsButton.addEventListener("click", () => {
            howToPlayContainer.style.display = "none";
            settingsContainer.style.display = "block";
        });

        // Ses kontrolü
        soundToggle.addEventListener("change", () => {
            soundEnabled = soundToggle.checked;
        });

        // Hızlı başlat
        quickStartButton.addEventListener("click", () => {
            if (Object.values(words).every(arr => arr.length === 0)) {
                alert("Önce bir Excel dosyası yükleyin!");
                return;
            }
            startButton.click();
        });

        // Oyunu başlat
        startButton.addEventListener("click", () => {
            const selectedWordCount = parseInt(wordCountSelect.value);
            timeLeft = parseInt(durationSelect.value);
            passCount = parseInt(passCountSelect.value);
            initialPassCount = passCount;
            const difficulty = difficultySelect.value;

            if (isNaN(timeLeft) || timeLeft < 10 || timeLeft > 300) {
                alert("Geçerli bir süre seçin (10-300 saniye)!");
                return;
            }

            if (correctKeyInput.value === incorrectKeyInput.value || correctKeyInput.value === passKeyInput.value || incorrectKeyInput.value === passKeyInput.value) {
                alert("Doğru, yanlış ve pas tuşları farklı olmalı!");
                return;
            }

            if (Object.values(words).every(arr => arr.length === 0)) {
                alert("Lütfen önce bir Excel dosyası yükleyin!");
                return;
            }

            let availableWords = [];
            if (difficulty === "random") {
                const categories = ["simple", "medium", "hard"];
                let tempWords = { simple: [], medium: [], hard: [] };
                categories.forEach(category => {
                    tempWords[category] = words[category].filter(word => !usedWords[category].has(word));
                    if (tempWords[category].length === 0) {
                        usedWords[category].clear();
                        tempWords[category] = words[category].slice();
                    }
                });

                for (let i = 0; i < selectedWordCount; i++) {
                    const category = categories[i % 3];
                    if (tempWords[category].length > 0) {
                        const index = Math.floor(Math.random() * tempWords[category].length);
                        const word = tempWords[category].splice(index, 1)[0];
                        availableWords.push({ text: word, category });
                    } else {
                        alert(`${category} kategorisinde kelime kalmadı, sıfırlanıyor.`);
                        usedWords[category].clear();
                        tempWords[category] = words[category].slice();
                        i--;
                    }
                }
            } else {
                availableWords = words[difficulty].filter(word => !usedWords[difficulty].has(word)).map(word => ({ text: word, category: difficulty }));
                if (availableWords.length < selectedWordCount) {
                    alert(`Yeterli ${difficulty} kelime yok! Kalan: ${availableWords.length}. Kelimeler sıfırlanıyor.`);
                    usedWords[difficulty].clear();
                    availableWords = words[difficulty].map(word => ({ text: word, category: difficulty }));
                }
            }

            if (availableWords.length < selectedWordCount) {
                alert(`Yeterli kelime yok! Mevcut: ${availableWords.length}, İstenen: ${selectedWordCount}`);
                return;
            }

            gameWords = availableWords.slice(0, selectedWordCount);
            gameWords.forEach(word => usedWords[word.category].add(word.text));

            settingsContainer.style.display = "none";
            gameContainer.style.display = "block";
            currentWordIndex = 0;
            correctCount = { simple: 0, medium: 0, hard: 0 };
            incorrectCount = { simple: 0, medium: 0, hard: 0 };
            streak = 0;
            fastestResponse = Infinity;
            missedWords = [];
            correctScoreElement.textContent = "Doğru: 0";
            incorrectScoreElement.textContent = "Yanlış: 0";
            passCountElement.textContent = `Pas: ${passCount}`;
            gameOverElement.style.display = "none";
            wordElement.style.display = "block";
            timerElement.style.display = "block";
            passCountElement.style.display = "block";
            pauseButton.style.display = "block";
            fullscreenButton.style.display = "block";
            touchControls.style.display = window.innerWidth <= 600 ? "block" : "none";
            if (soundEnabled) gameStartSound.play();
            startTimer();
            showWord();
        });

        // Tam ekran modu
        fullscreenButton.addEventListener("click", () => {
            if (document.fullscreenElement) {
                document.exitFullscreen();
                fullscreenButton.textContent = "Tam Ekran";
            } else {
                gameContainer.requestFullscreen();
                fullscreenButton.textContent = "Tam Ekranı Kapat";
            }
        });

        document.addEventListener("fullscreenchange", () => {
            fullscreenButton.textContent = document.fullscreenElement ? "Tam Ekranı Kapat" : "Tam Ekran";
        });

        // Duraklatma
        pauseButton.addEventListener("click", () => {
            isPaused = !isPaused;
            pauseButton.textContent = isPaused ? "Devam Et" : "Duraklat";
            if (isPaused) {
                clearInterval(timerInterval);
                timerInterval = null;
                gameContainer.style.opacity = "0.5";
            } else {
                startTimer();
                gameContainer.style.opacity = "1";
            }
        });

        // Tekrar oyna
        function replayGame() {
            settingsContainer.style.display = "block";
            gameContainer.style.display = "none";
            if (document.fullscreenElement) document.exitFullscreen();
            currentPlayer = 1;
        }

        // Yeni kelime göster
        function showWord() {
            if (gameWords.length === 0 || currentWordIndex >= gameWords.length || timeLeft <= 0) {
                endGame();
                return;
            }
            wordElement.textContent = gameWords[currentWordIndex].text;
            wordElement.classList.remove("correct", "incorrect", "pass");
            wordStartTime = Date.now();
            updateProgress();
        }

        // İlerleme çubuğu
        function updateProgress() {
            const percent = ((gameWords.length - currentWordIndex) / gameWords.length) * 100;
            progressBar.style.width = `${percent}%`;
        }

        // Oyunu bitir
        function endGame() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            wordElement.style.display = "none";
            timerElement.style.display = "none";
            passCountElement.style.display = "none";
            pauseButton.style.display = "none";
            fullscreenButton.style.display = "none";
            touchControls.style.display = "none";
            gameOverElement.style.display = "block";
            if (soundEnabled) gameEndSound.play();

            const totalCorrectPoints = correctCount.simple * 1 + correctCount.medium * 2 + correctCount.hard * 3;
            const streakBonus = Math.floor(streak / 5) * 5;
            const fastBonus = Object.values(correctCount).reduce((sum, count) => sum + count, 0) * 0.5; // Varsayılan olarak her doğru için hızlı varsayalım
            const totalScore = totalCorrectPoints - (Object.values(incorrectCount).reduce((sum, count) => sum + count, 0)) - (initialPassCount - passCount) * 0.5 + streakBonus + fastBonus;
            const usedPassCount = initialPassCount - passCount;

            playerScores[currentPlayer].correct.simple += correctCount.simple;
            playerScores[currentPlayer].correct.medium += correctCount.medium;
            playerScores[currentPlayer].correct.hard += correctCount.hard;
            playerScores[currentPlayer].incorrect.simple += incorrectCount.simple;
            playerScores[currentPlayer].incorrect.medium += incorrectCount.medium;
            playerScores[currentPlayer].incorrect.hard += incorrectCount.hard;
            playerScores[currentPlayer].pass += usedPassCount;
            playerScores[currentPlayer].total += totalScore;

            gameHistory.push({
                player: currentPlayer,
                correct: { ...correctCount },
                incorrect: { ...incorrectCount },
                pass: usedPassCount,
                total: totalScore,
                timestamp: new Date().toLocaleString("tr-TR")
            });
            localStorage.setItem("gameHistory", JSON.stringify(gameHistory));

            let historyTable = `
                <table id="history-table">
                    <tr>
                        <th>Oyuncu</th>
                        <th>Tarih</th>
                        <th>Doğru</th>
                        <th>Yanlış</th>
                        <th>Pas</th>
                        <th>Toplam Puan</th>
                    </tr>
            `;
            gameHistory.forEach(record => {
                historyTable += `
                    <tr>
                        <td>${record.player}</td>
                        <td>${record.timestamp}</td>
                        <td>${record.correct.simple + record.correct.medium + record.correct.hard}</td>
                        <td>${record.incorrect.simple + record.incorrect.medium + record.incorrect.hard}</td>
                        <td>${record.pass}</td>
                        <td>${record.total}</td>
                    </tr>
                `;
            });
            historyTable += "</table>";

            let leaderboard = "<h3>Lider Tablosu</h3><ol>";
            gameHistory.sort((a, b) => b.total - a.total).slice(0, 5).forEach(record => {
                leaderboard += `<li>Oyuncu ${record.player}: ${record.total} puan (${record.timestamp})</li>`;
            });
            leaderboard += "</ol>";

            let missedWordsList = missedWords.length > 0 ? `
                <h3>Kaçırdığın Kelimeler</h3>
                <ul>
                    ${missedWords.map(w => `<li>${w.text} (${w.category}) - ${definitions[w.category][w.text]}</li>`).join("")}
                </ul>
            ` : "";

            gameOverElement.innerHTML = `
                <h2>Oyun Bitti! (Oyuncu ${currentPlayer})</h2>
                <div style="font-size: 2em; margin: 10px 0;">Toplam Puan: ${totalScore.toFixed(1)}</div>
                <div style="font-size: 1.2em; margin: 5px 0;">
                    <h3>Puan Detayları</h3>
                    <div>Basit Doğru: ${correctCount.simple} (+${correctCount.simple * 1})</div>
                    <div>Orta Doğru: ${correctCount.medium} (+${correctCount.medium * 2})</div>
                    <div>Zor Doğru: ${correctCount.hard} (+${correctCount.hard * 3})</div>
                    <div>Yanlış: ${incorrectCount.simple + incorrectCount.medium + incorrectCount.hard} (-${incorrectCount.simple + incorrectCount.medium + incorrectCount.hard})</div>
                    <div>Pas: ${usedPassCount} (-${usedPassCount * 0.5})</div>
                    <div>5 Doğru Streak Bonusu: ${streakBonus}</div>
                    <div>Hızlı Cevap Bonusu: ${fastBonus.toFixed(1)}</div>
                </div>
                <div style="font-size: 1.2em; margin: 20px 0;">
                    <h3>Performans Özeti</h3>
                    <div>En hızlı doğru cevabın: ${fastestResponse === Infinity ? "Yok" : (fastestResponse / 1000).toFixed(2)} saniye</div>
                    <div>Pas oranı: ${usedPassCount / (correctCount.simple + correctCount.medium + correctCount.hard + incorrectCount.simple + incorrectCount.medium + incorrectCount.hard + usedPassCount || 1).toFixed(2)}%</div>
                </div>
                ${missedWordsList}
                <button id="replay-button">Tekrar Oyna</button>
                <button id="next-player-button">Sonraki Oyuncu</button>
                <button id="share-button">Puanı Paylaş</button>
                <br><br>
                ${leaderboard}
                <h3>Geçmiş Sonuçlar</h3>
                ${historyTable}
            `;
            document.getElementById("replay-button").addEventListener("click", replayGame);
            document.getElementById("next-player-button").addEventListener("click", () => {
                currentPlayer++;
                playerScores[currentPlayer] = { correct: { simple: 0, medium: 0, hard: 0 }, incorrect: { simple: 0, medium: 0, hard: 0 }, pass: 0, total: 0 };
                startButton.click();
            });
            document.getElementById("share-button").addEventListener("click", () => {
                const text = `Kelime Oyununda ${totalScore.toFixed(1)} puan aldım! Sen de dene!`;
                navigator.share?.({ text }) || alert("Paylaş: " + text);
            });
        }

        // Puan güncelle
        function updateScore(isCorrect, isPass = false) {
            const responseTime = Date.now() - wordStartTime;
            const category = gameWords[currentWordIndex].category;
            let fastBonus = 0;
            if (responseTime <= 2000 && isCorrect) {
                fastBonus = 0.5;
                fastestResponse = Math.min(fastestResponse, responseTime);
            }
            if (isCorrect) {
                correctCount[category]++;
                streak++;
                if (streak >= 5) {
                    streak = 0;
                }
                correctScoreElement.textContent = `Doğru: ${correctCount.simple + correctCount.medium + correctCount.hard}`;
                if (soundEnabled) correctSound.play();
            } else if (isPass) {
                passCount--;
                missedWords.push({ text: gameWords[currentWordIndex].text, category });
                streak = 0;
                passCountElement.textContent = `Pas: ${passCount}`;
                if (soundEnabled) passSound.play();
            } else {
                incorrectCount[category]++;
                missedWords.push({ text: gameWords[currentWordIndex].text, category });
                streak = 0;
                incorrectScoreElement.textContent = `Yanlış: ${incorrectCount.simple + incorrectCount.medium + incorrectCount.hard}`;
                if (soundEnabled) incorrectSound.play();
            }
            return fastBonus;
        }

        // Süre sayacı
        function startTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            timerElement.textContent = `Süre: ${timeLeft}`;
            timerElement.classList.remove("low");
            
            timerInterval = setInterval(() => {
                timeLeft--;
                timerElement.textContent = `Süre: ${timeLeft}`;
                
                if (timeLeft <= 10) {
                    timerElement.classList.add("low");
                }
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                    endGame();
                }
            }, 1000);
        }

        // Klavye olayları
        document.addEventListener("keydown", (event) => {
            if (isPaused || gameWords.length === 0 || currentWordIndex >= gameWords.length || timeLeft <= 0) return;

            const correctKey = correctKeyInput.value.toLowerCase();
            const incorrectKey = incorrectKeyInput.value.toLowerCase();
            const passKey = passKeyInput.value.toLowerCase() || " ";

            if (event.key.toLowerCase() === correctKey) {
                wordElement.classList.add("correct");
                updateScore(true);
                currentWordIndex++;
                setTimeout(showWord, 300);
            } else if (event.key.toLowerCase() === incorrectKey) {
                wordElement.classList.add("incorrect");
                updateScore(false);
                currentWordIndex++;
                setTimeout(showWord, 300);
            } else if (event.key.toLowerCase() === passKey && passCount > 0) {
                wordElement.classList.add("pass");
                updateScore(false, true);
                currentWordIndex++;
                setTimeout(showWord, 300);
            }
        });

        // Dokunmatik kontroller
        touchLeft.addEventListener("touchstart", (e) => {
            e.preventDefault();
            if (isPaused || gameWords.length === 0 || currentWordIndex >= gameWords.length || timeLeft <= 0) return;
            touchLeft.style.background = "rgba(0, 255, 0, 0.5)";
            setTimeout(() => touchLeft.style.background = "green", 300);
            wordElement.classList.add("correct");
            updateScore(true);
            currentWordIndex++;
            setTimeout(showWord, 300);
        });
        touchRight.addEventListener("touchstart", (e) => {
            e.preventDefault();
            if (isPaused || gameWords.length === 0 || currentWordIndex >= gameWords.length || timeLeft <= 0) return;
            touchRight.style.background = "rgba(255, 0, 0, 0.5)";
            setTimeout(() => touchRight.style.background = "red", 300);
            wordElement.classList.add("incorrect");
            updateScore(false);
            currentWordIndex++;
            setTimeout(showWord, 300);
        });
        touchMiddle.addEventListener("touchstart", (e) => {
            e.preventDefault();
            if (isPaused || gameWords.length === 0 || currentWordIndex >= gameWords.length || timeLeft <= 0 || passCount <= 0) return;
            touchMiddle.style.background = "rgba(0, 0, 255, 0.5)";
            setTimeout(() => touchMiddle.style.background = "blue", 300);
            wordElement.classList.add("pass");
            updateScore(false, true);
            currentWordIndex++;
            setTimeout(showWord, 300);
        });
    </script>
</body>
</html>